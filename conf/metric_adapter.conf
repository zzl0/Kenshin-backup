# coding: utf-8

# This file is used by rurouni/metric_adapter.py

METRIC_ADAPTER_CONFIG = [
    ### switches

    (
        'switches\.(?P<switch>{NAME})\.(?P<net>{NAME})\.(?P<stat_typ>{NAME})',
        'switches.{switch} net={net},stat_typ={stat_typ}'
    ),

    ### mfs

    (
        'mfs\.(?P<host>{NAME})\.(?P<stat_typ>{NAME})',
        'mfs host={host},stat_typ={stat_typ}'
    ),
    (
        'mfs\.(?P<stat_typ>{NAME})',
        'mfs stat_typ={stat_typ}'
    ),

    ### servers

    # servers.pott2.iostat.sd*.util_percentage 556 6
    (
        'servers\.(?P<host>{NAME})\.iostat\.(?P<disk>{NAME})\.(?P<stat_typ>{NAME})',
        'servers.{host}.iostat disk={disk},iostat_type={stat_type}'
    ),

    # servers.*.scribe.*.queue_size 68 382
    (
        'servers\.(?P<host>{NAME})\.scribe\.(?P<port>{NUM})\.(?P<stat_typ>{NAME})',
        'servers.scribe.{stat_typ} host={host},port={port}'
    ),
    (
        'servers\.(?P<host>{NAME})\.(?P<module>{NAME})\.(?P<stat_typ>{NAME})',
        'servers.{host} module={module},stat_typ={stat_typ}'
    ),
    (
        'servers\.(?P<host>{NAME})\.(?P<module>{NAME})\.(?P<sub_module>{NAME})\.(?P<stat_typ>{NAME})',
        'servers.{host} module={module},sub_module={sub_module},stat_typ={stat_typ}'
    ),

    ### stats counters

    ## solr
    (
        'stats\.counters\.solr\.(?P<stat_typ>{NAME})\.rate',
        'stats.counters.solr.rate stat_typ={stat_typ}'
    ),

    ## web
    # stats.counters.web.*.bandwidth.rate 16328 61
    (
        'stats\.counters\.web\.(?P<app>{NAME})\.(?P<flow_typ>{NAME})\.rate',
        'stats.counters.web.rate app={app},flow_typ={flow_typ}'
    ),
    # stats.counters.web.*.code.500.rate 3630 36
    (
        'stats\.counters\.web\.(?P<app>{NAME})\.code\.(?P<httpcode>{NAME})\.rate',
        'stats.counters.web.code.rate app={app},httpcode={httpcode}'
    ),

    ## fusible
    # stats.counters.fusible.*.*.*.fail.rate 3345 376
    (
        'stats\.counters\.fusible\.(?P<app>{NAME})\.(?P<interface>{NAME})\.(?P<host>{NAME})\.fail\.rate',
        'stats.counters.fusible.fail.rate app={app},interface={interface},host={host}'
    ),

    # stats.counters.release.shire.errorlog.*.rate 17 82
    (
        'stats\.counters\.release\.shire\.errorlog\.(?P<host>{NAME})\.rate',
        'stats.counters.release.shire.errorlog.rate host={host}'
    ),

    ## dae

    # stats.counters.dae._sys.nginx_upstream_errors.anduin.*.rate 656 28
    (
        'stats\.counters\.dae\._sys\.nginx_upstream_errors\.(?P<app>{NAME})\.(?P<host>{NAME})\.rate',
        'stats.counters.dae._sys.nginx_upstream_errors.rate app={app},host={host}'
    ),

    (
        'stats\.counters\.dae\.(?P<app>{NAME})\.(?P<flow_typ>{FLOW_TYPE})\.rate',
        'stats.counters.dae.dataflow.rate app={app},flow_typ={flow_typ}'
    ),
    (
        'stats\.counters\.dae\.(?P<app>{NAME})\.http\.(?P<httpcode>{NAME})\.rate',
        'stats.counters.dae.http.rate app={app},httpcode={httpcode}'
    ),
    (
        'stats\.counters\.dae\.(?P<app>{NAME})\.(?P<any>{ANY})\.rate',
        'stats.counters.dae.{any}.rate app={app}'
    ),

    ### stats timer

    ## web

    (
        'stats\.timers\.web\.(?P<app>{NAME}).mean(?P<pct>{NAME})',
        'stats.timers.web.mean app={app},pct={pct}'
    ),
    (
        'stats\.timers\.web\.(?P<app>{NAME}).(?P<agg>{NAME})',
        'stats.timers.web.sum app={app},agg={agg}'
    ),

    ## fusible
    (
        'stats\.timers\.fusible\.(?P<app>{NAME})\.(?P<interface>{NAME})\.(?P<host>{NAME}).time.(?P<agg>{NAME})',
        'stats.timers.fusible.time app={app},interface={interface},host={host},agg={agg}'
    ),

    ## sqlstore
    (
        'stats\.timers\.sqlstore\.(?P<farm>{NAME})\.(?P<cmd>{NAME}).(?P<agg>{NAME})',
        'stats.timers.sqlstore farm={farm},cmd={cmd},agg={agg}'
    ),

    # dae
    (
        'stats\.timers\.dae\.(?P<app>{NAME})\.(?P<any>{ANY})',
        'stats.timers.dae.{any} app={app}'
    ),

    ### stats gauges

    # stats.gauges.dae.music.web.default.busy_workers_mark_cnt.* 683 19
    (
        'stats\.gauges\.dae\.(?P<app>{NAME})\.web\.(?P<url_type>{NAME})\.(?P<worker_type>{NAME})\.(?P<host>{NAME})',
        'stats.gauges.dae.{app}.web.{worker_type} url_type={url_type},host={host}'
    ),
    (
        'stats\.gauges\.dae\.(?P<app>{NAME})\.(?P<any>{ANY})',
        'stats.gauges.dae.{any} app={app}'
    ),

    # docker
    (
        'stats\.gauges\.docker\.container\.(?P<name>{NAME})\.(?P<module>{NAME})\.(?P<stat_typ>{NAME})',
        'stats.gauges.docker.container name={name},module={module},stat_typ={stat_typ}'
    )
]

# - carbon
#     - agents
#         - <server>:2
#             - cache
#                 - overflow
#                 - queries
#                 - queues
#                 - size
#             - avgUpdateTime
#             - creates
#             - memUsage
#             ...:6
#     - relays
#         - <instance>:4
#             - destinations
#                 - <destination>:2
#                     - sent
#                     - queueUntilReady
#                     ...:3
#             - memUsage
#             - cpuUsage
#             - metricsReceived

# # 废弃了 ?
# - collectd
#     - lo5i
#         - snmp
#             - <if>:66
#                 - rx
#                 - tx
#             - stack_mem-1

# - switches
#     - l05i
#         - <if>:~=48
#             - ifInErrors
#             - ifOutDiscards
#             - ifSpeed
#             ...:13

# - mfs
#     - <server>:356
#         - getattr
#         - link
#         - read
#         ...:14
#     - getattr
#     - link
#     - read
#     ...:14

# - servers
#     - <server>:391
#         - cpu
#             - total
#                 - guest
#                 - user
#                 - system
#                 ...:7
#         - diskspace
#             - root
#                 - byte_used
#                 - inodes_used
#                 - byte_avail
#                 ...:3
#         - loadavg
#             - 01
#             - 05
#             - 15
#             ...:2
#         - network
#             - lan
#                 - rx_byte
#                 - tx_byte
#                 - rx_drop
#                 ...: 13
#             - wan
#                 ...: 16
#         - scribe
#             - 1463
#                 - queue_size
#                 - received_good
#         - tcp
#             - ActiveOpens
#             - InErrs
#             - ListenDrops
#             ...:12
#         - udp
#             - InErrors
#             - InDatagrams
#             - OutDatagrams
#             ...:3
#         - vmstat
#             - pgpgout
#             ...:3
#         - dataspace
#             - <disk>:depends on server
#                 - byte_used
#                 - inodes_used
#                 - byte_avail
#                 ...:3
#         - iostat
#             - <disk>:dpends on server
#                 - read
#                 - write_byte_per_second
#                 - io
#                 ...:27
#         - memory
#             ...:14
#         - proc
#             ...:5
#         - sockets
#             ...:8

# - stats
#     - counters
#         - dae
#             - <app_name>:117
#                 - bandwidth
#                 - errors
#                 - http
#                 - mq
#                 - qps
#                 - reqs
#                 - waylife
#                 - web
#             - _sys
#             - _dummy
#             - _leo
#             - _service_client
#             - _lb
#             - _service
#     - gauges
#         - dae
#             - <app_name>:117
#                 - cputime
#                     - <servername>: ~= 30
#                 - pcpu
#                     - <servername>: ~= 30
#                 - total_pcpu
#                     - <servername>: ~= 30
#                 - rss
#                     - <servername>: ~= 30
#                 - total-rss
#                     - <servername>: ~= 30
#                 - vertical_flag
#                     - auto_scale
#                 - web
#                     - _admin
#                         - busy_workers
#                             - <servername>: ~= 30
#                         - busy_workers_mark_cnt
#                             - <servername>: ~= 30
#                         - busy_workers_mark_cnt_fast
#                             - <servername>: ~= 30
#                         - nworkers
#                             - <servername>: ~= 30
#                     - default
#                         - busy_workers
#                             - <servername>: ~= 30
#                         - busy_workers_mark_cnt
#                             - <servername>: ~= 30
#                         - busy_workers_mark_cnt_fast
#                             - <servername>: ~= 30
#                         - nworkers
#                             - <servername>: ~= 30
#                         - perftest
#                             - <servername>: ~= 30
#     - statsd
#         - graphiteStats
#             ...:5
#         ...:4

#     - timers
#         - dae
#             - <app_name>
#                 - req_time
#                 - req_time_real
#                 - waylife
#                     - douban
#                         - beansdb
#                         - mc
#                         - sqlstore
#                 - web
#                     - _admin
#                         - req_time
#                     - default
#                         - queue_time
